<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui" />
  <meta charset="utf-8" />
  <title>Splinter Cell Online PS2</title>
  <meta name="Splinter Cell Online"
    content="Splinter Cell Online PS2 is a multiplayer gaming community that plays on playstation 2.">

  <!-- CSS  -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.7.2/dist/full.min.css" rel="stylesheet" type="text/css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
  <link rel="icon" href="{{url_for('static', filename='scops2_rounded.png')}}" type="image/png">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>



</head>

<body>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>


  <!-- Documentation:
   https://daisyui.com/
   https://tailwindcss.com/
   https://www.highcharts.com/
   https://vuejs.org/
   https://pyodide.org/en/stable/
   https://www.papaparse.com/
   https://danfo.jsdata.org/
   https://axios-http.com/docs/intro -->

  <div id="index_app2" class="drawer drawer-end">
    <input id="my-drawer-4" type="checkbox" class="drawer-toggle" />
    <div class="drawer-content flex flex-col">
      <!-- Navbar -->
      <div class="w-full navbar bg-neutral text-neutral-content shadow-xl">
        <div class="avatar">
          <div class="w-8 rounded-lg">
            <img v-if="avatar != 'none' && avatar != 'undefined' "
              v-bind:src=" 'https://cdn.discordapp.com/avatars/' + [[ discord_id ]] + '/' + [[ avatar ]] + '.png' " />
          </div>
        </div>
        <div v-if="username != 'undefined'" class="flex-1 px-2 mx-2  btn btn-ghost normal-case text-lg ">
          <a>[[username]]</a>
        </div>
        <div v-else class="flex-1 px-2 mx-2  btn btn-ghost normal-case text-lg "><a></a></div>
        <div class="flex-none hidden lg:block">
          <ul class="menu menu-horizontal">
            <!-- Navbar menu content here -->
            <!-- <div class="avatar online">
              <div class="w-24 rounded-full">
                <img src="https://placeimg.com/192/192/people" />
              </div>
            </div> -->
            <!-- <div class="avatar offline">
              <div class="w-16 rounded-full">
                <img src="https://cdn.discordapp.com/avatars/537355342313422849/1ee4375beb131ae43a4e4b81e267a265" />
              </div>
            </div> -->
            <li><a href="/" class="btn btn-ghost btn-ghost normal-case text-green-400 hover:text-green-400">Home<i
                  class="material-icons ">home</i></a>
            </li>
            <li><a href="https://www.splintercellonline.net/Gameplay/"
                class="btn btn-ghost btn-ghost normal-case hover:text-base-100">Gameplay<i
                  class="material-icons ">live_tv</i></a></li>
            <li><a href="https://www.splintercellonline.net/Videos/"
                class="btn btn-ghost btn-ghost normal-case hover:text-base-100">Tutorials<i
                  class="material-icons ">videogame_asset</i></a>
            </li>
            <li><a href="https://www.splintercellonline.net/SetupGuide/PS2/"
                class="btn btn-ghost normal-case hover:text-base-100">Setup Guide<i
                  class="material-icons ">format_list_numbered</i></a></li>
            <!-- <li><a href="/Messages/" class="btn btn-ghost normal-case hover:text-base-100">Messages<i
              class="material-icons ">forum</i></a></li> -->
            <li><a href="https://www.splintercellonline.net/Leaderboards"
                class="btn  btn-ghost normal-case hover:text-base-100">Leaderboards<i
                  class="material-icons ">insert_chart</i></a></li>
            <div v-if="role === 'admin'">
              <li><a href="https://www.splintercellonline.net/Dashboard_Uploads"
                  class="btn btn-ghost normal-case hover:text-base-100">Admin Dashboard<i
                    class="material-icons">dashboard</i></a>
              </li>
            </div>
            <li><a href="https://www.splintercellonline.net/signout"
                class="rounded-md tooltip tooltip-bottom hover:text-base-300" data-tip="no, don't go!">Logout</a></li>
          </ul>
        </div>
        <div class="flex-none lg:hidden">
          <label for="my-drawer-4" class="btn btn-square btn-ghost">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
              class="inline-block w-6 h-6 stroke-current">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </label>
        </div>

      </div>
      <div id="content">
        <div class=" min-h-screen">
          <div style="text-align: center;">
            <center>
              <div class="h-full">
                <div class="flex flex-row w-full justify-between p-2">
                  <label class="input input-bordered flex items-center gap-2">
                    Server IP: 
                    <input type="text" class="grow" v-model="wireguard_server" />
                  </label>
                  <label class="input input-bordered flex items-center gap-2">
                    PS2 IP: 
                    <input type="text" class="grow" v-model="ps2_ip" />
                  </label>
                </div>
                <button v-if="ps2_ip && wireguard_server" @click="connect"
                  class="btn bg-green-500 stroke-green-500 hover:bg-green-500 hover:border-green-500 hover:shadow-lg hover:shadow-green-500/50 text-base-100 grow">
                  Connect
                </button>
                <button v-else
                  class="btn btn-disabled text-base-100 grow">
                  Connect
                </button>
              </div>
            </center>
          </div>

          <div v-if="status == 'success'" class="toast toast-bottom toast-end">
            <div class="alert alert-success">
              <div>
                <span>[[reason]]</span>
              </div>
            </div>
          </div>
          <div v-else-if="status == 'fail'" class="toast toast-bottom toast-end">
            <div class="alert alert-warning">
              <div>
                <span>[[reason]]</span>
              </div>
            </div>
          </div>

          <div class="container">
            <div class="section">

            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="drawer-side">
      <label for="my-drawer-4" class="drawer-overlay"></label>
      <ul class="menu p-4 overflow-y-auto w-80 bg-base-100 h-full">
        <!-- Sidebar content here -->
        <div class="center">
          <img src="{{url_for('static', filename='scops2_rounded.png')}}" width="90%" />
        </div>
        <li><a href="/"><i class="material-icons ">home</i>Home</a></li>
        <li><a href="https://www.splintercellonline.net/Gameplay/"><i class="material-icons">live_tv</i>Gameplay</a>
        </li>
        <li><a href="https://www.splintercellonline.net/Videos/"><i
              class="material-icons ">videogame_asset</i>Tutorials</a></li>
        <li><a href="https://www.splintercellonline.net/SetupGuide/PS2/"><i
              class="material-icons ">format_list_numbered</i>Setup Guide</a></li>
        <!-- <li><a href="/Messages/"><i class="material-icons ">forum</i>Messages</a></li> -->
        <li><a href="https://www.splintercellonline.net/Leaderboards"><i
              class="material-icons">insert_chart</i>Leaderboards</a></li>
        <div v-if="role === 'admin'">
          <li><a href="https://www.splintercellonline.net/Dashboard_Uploads"><i
                class="material-icons">dashboard</i>Admin Dashboard</a>
          </li>
        </div>


        <br>
        <li><a href="https://www.splintercellonline.net/signout"
            class="btn btn-block bg-green-500 border-green-500 hover:border-green-500 shadow-lg shadow-green-500/50  hover:bg-green-500  hover:shadow-xl hover:shadow-green-500/50 no-animation">Logout</a>
        </li>

      </ul>
    </div>
  </div>
</body>
<!-- <script>
  // Disable right-clicking
  document.addEventListener('contextmenu', function (event) {
    event.preventDefault();
  });
</script> -->
<script>
  const { createApp } = Vue

  createApp({
    delimiters: ['[[', ']]'],
    data() {
      return {
        message: 'Welcome to SCOPS2!',
        host_ip: '',
        activeTab: 2,
        connection: 'portforward',
        ps2_ip: '',
        players: [],
        connected: 'false',
        data: '',
        discord_id: '',
        avatar: '',
        role: '',
        email: '',
        status: '',
        reason: '',
        pwa_install: '',
        username: '',
        django_username: '',
        wireguard_server: 'http://20.55.32.50:5000',//'game.scct.airmon-ster.com',
        url: 'http://127.0.0.1:8000',//'https://www.splintercellonline.net',//'http://127.0.0.1:8000',
        lobby: '',
        lobbies: [],
        nics: [],
        adapter: '',
        client_ip: '',
        wireguard_status: '',
        private_key: '',
        server_pub_key: '',

      }
    },
    methods: {
      setActiveTab(tab) {
        this.activeTab = tab;
      },
      async connect() {
        // remove null player entries from player list
        // create content for server arguments
        if (this.client_ip == ''){
          this.create_wireguard_client()
        }
        const content = {
          // host: this.django_username,
          // host_username: this.username,
          ps2_ip: this.ps2_ip,
          // adapter: this.adapter,
          client_ip: this.client_ip,
        }
          const response = await axios.post('/api/connect', content)
          .then(() => {
            // handle success
            // this.connected = 'true';
            this.status = JSON.parse(JSON.stringify(response['data']['status']))

          }).catch(error => {
            console.log(error);
            this.status = JSON.parse(JSON.stringify(response['data']['status']))
            this.reason = JSON.parse(JSON.stringify(response['data']['message']))
          })

      },
      async create_wireguard_client(){
        const response = await axios.get(wireguard_server+'/scops_create_wireguard_client');
          if (JSON.parse(JSON.stringify(response['data']['status'])) == 'created'){
            this.client_ip = JSON.parse(JSON.stringify(response['data']['client_ip']))
            this.private_key = JSON.parse(JSON.stringify(response['data']['private_key']))
            this.server_pub_key = JSON.parse(JSON.stringify(response['data']['server_pub_key']))
            const content = {
              client_ip: this.client_ip,
              private_key: this.private_key,
              server_pub_key: this.server_pub_key,
              ps2_ip: this.ps2_ip,
            }
            const response = await axios.post('/api/create_config', content)
            this.status = JSON.parse(JSON.stringify(response['data']['status']))
            this.reason = 'Config created successfully.'
          } else {
            this.status = JSON.parse(JSON.stringify(response['data']['status']))
            this.reason = JSON.parse(JSON.stringify(response['data']['message']))
          }

      },
    },
    watch: {

    },
    async created() {
      console.log("{{data}}")
      this.django_username = "{{data.django_username}}";
      this.username = "{{data.username}}";
      this.discord_id = "{{data.discord_id}}";
      this.avatar = "{{data.avatar}}";
      this.role = "{{data.role}}";
      this.email = '{{data.email}}';
      this.status = '{{data.status}}';
      this.reason = '{{data.reason}}';

      // Make a request for a user with a given ID
      try {
        const response = await axios.get('/api/get_id');
        // handle success
        console.log(response);
        if (JSON.parse(JSON.stringify(response['data']['status'])) == 'success'){
          this.client_ip = JSON.parse(JSON.stringify(response['data']['client_ip']))
          console.log(this.client_ip)
        }
      } catch (error) {
        // handle error
        console.log(error);
      }

      // Replace these with your actual credentials
      const username = this.django_username;
      const password = this.discord_id;
      console.log(username)
      console.log(password)

      try {
        const response = await axios.post(this.url + '/api/v1/token/login/', {
          username: username,
          password: password
        });
        // handle success
        const token = response.data.auth_token;
        // Use the token in future requests
        axios.defaults.headers.common['Authorization'] = `Token ${token}`;
        // localStorage.setItem('token', token);

        console.log('Token stored and set in headers:', token);

      } catch (error) {
        // handle error
        console.error('Error fetching auth token:', error);
      }
      this.get_lobbies();
    },
    mounted() {
      this.email = 1; //this is to avoid the email prompt for now, in the future we can incorporate it... will also have to create logic to send the email upon new content uploads...
      if (this.email == '') {
        // document.getElementById(email_modal).showModal()
        email_modal.showModal()
      }
      // this.nics = [];
      // axios.get('/api/get_network_adapters')
      //   .then(response => {
      //     console.log(response.data)
      //     console.log(response.data['nics'])
      //     for (var item of response.data['nics']) {
      //       // console.log(JSON.stringify(response.data[item]))
      //       this.nics.push(item)
      //     }
      //   })
      //   .catch((err) => console.error(err));

      this.intervalCheck = setInterval(() => {
        this.lobbies_temp = [];
        axios.get(this.url + '/get_lobbies/')
          .then(response => {
            // console.log(response.data)
            for (var item of Object.keys(response.data)) {
              // console.log(JSON.stringify(response.data[item]))
              this.lobbies_temp.push(response.data[item])
            }
            if (this.lobbies_temp !== this.lobbies){
              this.lobbies = this.lobbies_temp;
            }
          })
          .catch((err) => console.error(err));
      }, 10000)
    },
    computed: {

    }

  }).mount('#index_app2')
</script>

</html>